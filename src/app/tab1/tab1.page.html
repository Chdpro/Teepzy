<ion-content [fullscreen]="true" [scrollY]="false">
  <ion-header class="ion-no-border">
    <ion-toolbar>

      <ion-title *ngIf="!showSearch">Bonjour Christian</ion-title>
      <div *ngIf="!showSearch" class="example-button-container">
        <button (click)="showSearch = true" class="btn-icon" mat-mini-fab
          aria-label="Example icon button with a home icon">
          <mat-icon>search</mat-icon>
        </button>
        <button mat-mini-fab disabled aria-label="Example icon button with a home icon">
          <mat-icon>settings</mat-icon>
        </button>
      </div>

      <span *ngIf="showSearch" style="display: flex;">
        <button (click)="showSearch = false" style="font-size: 29px;" (click)="dismiss()" mat-button>
          <ion-icon name="arrow-back-outline"></ion-icon>
        </button>
        <form style="margin-top: 85px; margin-bottom: -21px;" class="example-form">
          <mat-form-field appearance="outline" class="example-full-width search-input">
            <mat-label>Rechercher</mat-label>
            <input [(ngModel)]="search" name="search" matInput placeholder="Taper pour filtrer">
          </mat-form-field>
        </form>
      </span>

    </ion-toolbar>
  </ion-header>

  <ion-slides pager="true" [options]="slideOpts">
    <ion-slide *ngFor="let p of listPosts?.reverse() | filter:search ;trackBy: trackByFn "
      [style.background-color]="p?.backgroundColor"
      [ngStyle]="{'color': p?.backgroundColor == '#fff' ? 'black' : 'white' }">

      <div class="post-txt">
        <div style="line-height: 21px;
        margin-top: -10px;
        width: 223px;">
          <img class="img-poster" [src]="p?.userPhoto_url" alt="">
          <strong>
            {{p?.userPseudo}}
          </strong><br>
          <small>
            {{p?.circle || '' }}
          </small>
          <span class="time">
            {{time(p?.createdAt) }}
          </span>
        </div><br>
        <p>
          {{ p?.content }}
        </p>



      </div>


      <!-- fab placed to the bottom end -->
      <ion-fab (click)="getCommentsOfPost(p?._id)" style="margin-bottom: 150px;" vertical="bottom" horizontal="end"
        slot="fixed">
        <label class="modal-open modal-label" for="modal-open">

          <ion-fab-button color="light">

            <ion-icon name="chatbubble-outline"></ion-icon>
          </ion-fab-button>
        </label>

      </ion-fab>
      <!-- fab placed to the bottom end -->
      <ion-fab (click)="addFavorite(p?._id)" style="margin-bottom: 100px;" vertical="bottom" horizontal="end"
        slot="fixed">
        <ion-fab-button color="light">
          <ion-icon *ngIf="p?.favorite != true" name="star-outline"></ion-icon>
          <ion-icon *ngIf="p?.favorite == true" name="star"></ion-icon>
        </ion-fab-button>
      </ion-fab>

      <!-- fab placed to the bottom end -->
      <ion-fab (click)="sendShare()" style="margin-bottom: 50px;" vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button color="light">
          <ion-icon name="return-up-forward"></ion-icon>
        </ion-fab-button>
      </ion-fab>

      <!-- fab placed to the bottom end -->
      <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button color="light">
          <ion-icon name="people"></ion-icon>
        </ion-fab-button>
      </ion-fab>

    </ion-slide>

  </ion-slides>


  <div class="content">
    <input type="radio" name="modal" value="open" id="modal-open" class="modal-radio" />
    <div class="modal">
      <label class="modal-label overlay">
        <input type="radio" name="modal" value="close" class="modal-radio" />
      </label>
      <div class="content" style="overflow: auto;">
        <div class="top">
          <h3 style="text-align: center;"> {{listComments?.length}} Commentaire(s) </h3>
          <label class="modal-label close-btn">
            <input type="radio" name="modal" value="close" class="modal-radio" />
          </label>
        </div>
        <div>
  
          <mat-card *ngFor="let c of listComments;trackBy: trackByFn " class="example-card cmt">
            <mat-card-header>
              <div mat-card-avatar class="example-header-image"></div>
              <img mat-card-image class="mat-img" [src]="c?.userPhoto" alt="">

              <mat-card-title>{{c?.userPseudo}}</mat-card-title>
              <mat-card-subtitle></mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>
                  {{c?.comment}} 
              </p>

         
            </mat-card-content>
            <mat-card-actions>
              <button class="btn-icon" mat-button aria-label="Example icon button with a home icon">
                <ion-icon name="star-outline"></ion-icon>
              </button>
              <button (click)="getCommentsOfComment(c?._id)" class="btn-icon" mat-button aria-label="Example icon button with a home icon">
                (3) réponse(s)
              </button>
            </mat-card-actions>
            <div *ngIf="showResponsePanel" *ngFor="let cc of listCommentsOfComment;trackBy: trackByFn " class="mat-res">
                <img mat-card-image class="mat-img-res" [src]="c?.userPhoto"  alt="">

              <mat-card-title>{{cc?.userPseudo}}</mat-card-title>
              <mat-card-subtitle></mat-card-subtitle>
                {{cc?.comment}} 
              </div>

              <span  *ngIf="showResponsePanel" style="display: flex;" >
                  <!-- Textarea in an item with a placeholder -->
                  <ion-item class="ion-textarea">
                    <ion-textarea matInput name="commentC" required #commentC="ngModel" [(ngModel)]="commentC.comment"
                      placeholder="Répondre..."></ion-textarea>
                  </ion-item>
                  <button (click)="" [disabled]="commentC.errors?.required" style="font-size: 30px;margin-right: -5px;" mat-button>
                      <ion-icon name="send-outline"></ion-icon>
                  </button>
              </span>
          </mat-card>


        </div>

        <div *ngIf="listComments?.length == 0" style="margin-top: 112px;text-align: center;">
          Aucun Commentaire pour ce post
        </div>



        <mat-card class="comment-form">
            <div class="form-wrapper">
                <!-- Textarea in an item with a placeholder -->
                <ion-item class="ion-textarea">
                  <ion-textarea matInput name="comment" required #comment="ngModel" [(ngModel)]="commentT.comment"
                    placeholder="Commenter..."></ion-textarea>
                </ion-item>
      
                <ion-button (click)="addCommentToPost()" size="small" [disabled]="comment.errors?.required" expand="block"
                  shape="round">Envoyer</ion-button>
      
              </div>
      
        </mat-card>
     
      </div>
    </div>
  </div>
</ion-content>