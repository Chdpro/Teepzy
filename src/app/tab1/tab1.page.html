<ion-content [fullscreen]="true" [scrollY]="false">

  <ion-header class="ion-no-border">
    <ion-toolbar>
      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <h3 style="margin-top: 9px;color: #ea4e50;" *ngIf="!showSearch">Bonjour {{user?.prenom}}</h3>
          </ion-col>
          <ion-col>
            <div *ngIf="!showSearch" class="example-button-container">
              <button (click)="showSearch = true" class="btn-icon" mat-mini-fab
                aria-label="Example icon button with a home icon">
                <mat-icon>search</mat-icon>
              </button>
              <button style="text-align: center;" mat-mini-fab aria-label="Example icon button with a home icon">
                <ion-menu-button autoHide="false">
                  <mat-icon>settings</mat-icon>
                </ion-menu-button>
              </button>
            </div>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <span *ngIf="showSearch" style="display: flex;">
              <button (click)="showSearch = false" style="font-size: 29px;" mat-button>
                <ion-icon name="arrow-back-outline"></ion-icon>
              </button>
              <form style="margin-top: 65px; margin-bottom: -57px;" class="example-form">
                <mat-form-field appearance="outline" class="example-full-width search-input">
                  <mat-label>Rechercher</mat-label>
                  <input [(ngModel)]="search" name="search" matInput placeholder="Taper pour filtrer">
                </mat-form-field>
              </form>
            </span>
          </ion-col>
        </ion-row>
      </ion-grid>



    </ion-toolbar>
  </ion-header>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

    <ion-slides pager="true" (ionSlideNextEnd)="next()" (ionSlidePrevEnd)="prev()" [options]="slideOpts">

      <ion-slide *ngFor="let p of listPosts?.reverse() | filter:search ;trackBy: trackByFn "
        [style.background-color]="p?.backgroundColor"
        [ngStyle]="{'color': p?.backgroundColor == '#fff' ? 'black' : 'white' }">
        <div class="post-txt" (click)="next()">
            <span *ngIf="p?.reposterId == userId" style="font-size: small;">
                Vous avez publié la demande de 
            </span>
          <div style="line-height: 21px; margin-top: 11px;width: 223px;">
            <img class="img-poster" [src]="p?.userPhoto_url" alt="">
            <strong>
              {{p?.userPseudo}}
            </strong><br>
            <small>
              {{p?.circle || '' }}
            </small>
            <span class="time">
              {{time(p?.createdAt) }}
            </span>
          </div><br>
          <p>
            {{ p?.content }}
          </p>

          <div class="match-img">
            <span style="margin-top: 6px;">MATCH</span>
            <span style="margin-left: 6px;">
              <img class="match-image"
                src="../../assets/img/man-wearing-black-and-white-stripe-shirt-looking-at-white-212286.jpg" alt="">
            </span>
            <span style="margin-left: -9px;">
              <img class="match-image"
                src="../../assets/img/man-wearing-black-and-white-stripe-shirt-looking-at-white-212286.jpg" alt="">
            </span>
            <span style="margin-right: 6px;margin-left: -9px;">
              <img class="match-image"
                src="../../assets/img/man-wearing-black-and-white-stripe-shirt-looking-at-white-212286.jpg" alt="">
            </span>
            <span style="margin-top: 6px;">+3</span>

          </div>


        </div>

        <div>
          <ion-fab style="margin-bottom: 188px;" (click)="getCommentsOfPost(p?._id)" vertical="bottom" horizontal="end"
            slot="fixed">
            <ion-fab-button color="light">
              <label class="modal-open" for="modal-open">
                <ion-icon style="font-size: 26px;margin-top: 5px;" name="chatbubble"></ion-icon>
              </label>
            </ion-fab-button>
          </ion-fab>


          <!--button (click)="getCommentsOfPost(p?._id)" mat-mini-fab aria-label="Example icon button with a home icon">
            <label class="modal-open modal-label" for="modal-open">
              <mat-icon>home</mat-icon>
            </label>

          </button-->

          <!-- fab placed to the bottom end -->
          <ion-fab *ngIf="p?.favorite != true" (click)="addFavorite(p?._id)" style="margin-bottom: 133px;"
            vertical="bottom" horizontal="end" slot="fixed">
            <ion-fab-button color="light">
              <ion-icon name="star-outline"></ion-icon>
            </ion-fab-button>
          </ion-fab>
          <!-- fab placed to the bottom end -->
          <ion-fab *ngIf="p?.favorite == true" (click)="removeFavorite(p?._id)" style="margin-bottom: 133px;"
            vertical="bottom" horizontal="end" slot="fixed">
            <ion-fab-button color="light">
              <ion-icon name="star"></ion-icon>
            </ion-fab-button>
          </ion-fab>

          <!-- fab placed to the bottom end -->
          <label class="modal-open " for="modal-open2">
            <ion-fab style="margin-bottom: 75px;" (click)="openShareActionSheet(p)" vertical="bottom" horizontal="end" slot="fixed">
              <ion-fab-button color="light">
                <span class="material-icons">
                  redo
                </span>
              </ion-fab-button>
            </ion-fab>
          </label>


          <!-- fab placed to the bottom end -->
          <ion-fab vertical="bottom" style="    margin-bottom: 16px;" horizontal="end" slot="fixed">
            <ion-fab-button color="light">
              <span class="material-icons">
                group_add
              </span>
            </ion-fab-button>
          </ion-fab>

        </div>



      </ion-slide>
      <div class="next-btn" (click)="prev()">
        prev
      </div>
      <div class="prev-btn" (click)="next()">
        next
      </div>
    </ion-slides>



  <input type="radio" name="modal2" value="open" id="modal-open2" class="modal-radio" />
  <div class="modal2">
    <label class="modal-label overlay">
      <input type="radio" name="modal2" value="close" class="modal-radio" />
    </label>
    <div class="content">
      <div class="top" style="margin-top: -32px;color: black; text-align: center;">
        <h5>PARTAGER </h5>
        <label class="modal-label close-btn">
          <input type="radio" name="modal2" value="close" class="modal-radio" />
        </label>
      </div>
      <span>
        <!-- fab placed to the bottom end -->
        <ion-fab (click)="presentAlertConfirm(p?._id)" style="margin-bottom: 53px;text-align: center;" vertical="bottom"
          horizontal="start" slot="fixed">
          <ion-fab-button color="primary">
            <ion-icon style="color:white" name="flag-outline"></ion-icon>
          </ion-fab-button>
          <div class="text-share">
            signaler
          </div>
        </ion-fab>


        <!-- fab placed to the bottom end -->
        <ion-fab (click)="sendShare(p)" class="rs-btn" vertical="bottom" horizontal="start" slot="fixed">
          <ion-fab-button color="primary">
            <ion-icon style="color:white" name="share-social-outline"></ion-icon>
          </ion-fab-button>
          <div style="    margin-left: -18px;" class="text-share">
            Réseaux sociaux
          </div>
        </ion-fab>


        <!-- fab placed to the bottom end -->
        <ion-fab vertical="bottom" class="sv-btn" horizontal="end" slot="fixed">
          <ion-fab-button color="primary">
            <span style="color: #ffff;" class="material-icons">
              save_alt
            </span>
          </ion-fab-button>
          <div class="text-share">
            Enregistrer
          </div>
        </ion-fab>


        <!-- fab placed to the bottom end -->
        <ion-fab (click)="rePost(p)" vertical="bottom" style="margin-bottom: 53px;text-align: center;" horizontal="end"
          slot="fixed">
          <ion-fab-button color="primary">
            <span style="color:white" class="material-icons">
              redo
            </span>
          </ion-fab-button>
          <div class="text-share">
            Mon cercle
          </div>
        </ion-fab>
      </span>
    </div>
  </div>


    <input type="radio" name="modal" value="open" id="modal-open" class="modal-radio" />
    <div class="modal">
      <label class="modal-label overlay">
        <input type="radio" name="modal" value="close" class="modal-radio" />
      </label>
      <div class="content" style="overflow: auto;">
        <div class="top">
          <h5 style="text-align: center;margin-top: -14px;"> {{listComments?.length}} Commentaire <span
            style="margin-left: -4px;"  *ngIf="listComments?.length > 1"> s </span> </h5>
          <label class="modal-label close-btn">
            <input type="radio" name="modal" value="close" class="modal-radio" />
          </label>
        </div>
        <div>

          <mat-card *ngFor="let c of listComments?.reverse();trackBy: trackByFn " class="example-card cmt">
            <mat-card-header>
              <div mat-card-avatar class="example-header-image"></div>
              <img mat-card-image class="mat-img" [src]="c?.userPhoto" alt="">

              <mat-card-title>{{c?.userPseudo}}</mat-card-title>
              <mat-card-subtitle></mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p class="content-comment">
                {{c?.comment}}
              </p>
              <button class="btn-icon star-btn" mat-button aria-label="Example icon button with a home icon">
                <ion-icon name="star-outline"></ion-icon>
              </button>
            </mat-card-content>
            <mat-card-actions>

              <button (click)="getCommentsOfComment(c?._id)" class="btn-icon answers" mat-button
                aria-label="Example icon button with a home icon">
                Voir les réponses( {{ listCommentsOfComment?.length || '0' }} )
              </button>
            </mat-card-actions>
            <div *ngIf="showResponsePanel">
              <div *ngFor="let cc of listCommentsOfComment?.reverse();trackBy: trackByFn ">
                <div *ngIf="cc?.commentId == c?._id" class="mat-res">
                  <img mat-card-image class="mat-img-res" [src]="cc?.userPhoto" alt="">
                  <mat-card-title>{{cc?.userPseudo}}</mat-card-title>
                  <mat-card-subtitle></mat-card-subtitle>
                  {{cc?.comment}}
                </div>
              </div>

              <div *ngIf="listCommentsOfComment?.length == 0" style="text-align: center;">
                Aucune réponse
              </div>
            </div>
            <span *ngIf="showResponsePanel" style="display: flex;">
              <!-- Textarea in an item with a placeholder -->
              <ion-item class="ion-textarea">
                <ion-textarea matInput name="commentCc" required #commentCc="ngModel" [(ngModel)]="commentC.comment"
                  placeholder="Répondre..."></ion-textarea>
              </ion-item>
              <button (click)="addCommentToComment()" [disabled]="commentCc.errors?.required"
                style="font-size: 30px;margin-right: -5px;" mat-button>
                <ion-icon name="send-outline"></ion-icon>
              </button>
            </span>
          </mat-card>



          <div *ngIf="listComments?.length == 0" style="margin-top: 112px;text-align: center;">
            Aucun Commentaire pour ce post
          </div>

          <div class="fixContainer">
            <mat-card class="comment-form">
              <div class="form-wrapper">
                <!-- Textarea in an item with a placeholder -->
                <ion-item class="ion-textarea">
                  <ion-textarea matInput name="comment" required #comment="ngModel" [(ngModel)]="commentT.comment"
                    placeholder="Commenter..."></ion-textarea>
                </ion-item>
                <ion-button (click)="addCommentToPost()" size="small" [disabled]="comment.errors?.required"
                  expand="block" shape="round">Envoyer</ion-button>
              </div>
            </mat-card>
          </div>
        </div>

      </div>
    </div>
</ion-content>